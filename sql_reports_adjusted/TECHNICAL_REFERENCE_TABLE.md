# Complete Technical Reference Table - All Reports

**Purpose:** Comprehensive documentation of every input, filter, and metric across all 16 SQL reports for debugging, investigation, and technical reference.

**How to use this table:**
- Filter by **Report Name** to isolate a specific report for investigation
- Look up **Column name (final)** to see exact SQL implementation
- Use **Notes / edge cases** for debugging when metrics look incorrect
- Reference **Exact SQL conditions** to manually test queries in database

**Last Updated:** October 31, 2025

---

## Complete Technical Reference

| Report Name | Item Type | Metric / Field | Column name (final) | Source tables / CTEs used | Exact SQL conditions / filters used to derive it | Aggregation / Derivation logic (how value is computed from DB) | Notes / edge cases / debugging tips |
|-------------|-----------|----------------|---------------------|---------------------------|--------------------------------------------------|----------------------------------------------------------------|-------------------------------------|
| **All Reports** | Input | Start date | start_date | start_input, bounds | `[[ UNION ALL SELECT {{start_date}}::date ]]` OR default varies by report | Daily KPIs default: `end_date - INTERVAL '31 day'`; Monthly KPIs default: `end_date - INTERVAL '12 months'`; Cohort reports default: `DATE_TRUNC('month', CURRENT_DATE - INTERVAL '12 months')` | If start > end, bounds clamps start_date to end_date (guard). Ensure timezone consistent with created_at. NULL input triggers default calculation. |
| **All Reports** | Input | End date | end_date | end_input, bounds | `[[ UNION ALL SELECT {{end_date}}::date ]]` OR default: `CURRENT_DATE` | Taken from end_input when provided; else CURRENT_DATE. bounds.end_date used to build date_series. | end_ts uses `LEAST(d + INTERVAL '1 day', NOW())` to prevent future dates. For cohort reports, bounds adds +1 day for inclusive range. |
| **All Reports** | Filter | Brand (company name) | brand | filtered_players, players, companies | `[[ AND {{brand}} ]]` → Field Filter mapped to `companies.name` | Applied in filtered_players CTE; downstream CTEs INNER JOIN filtered_players so brand restricts all metrics | If brand not selected, no filter applied (all brands included). Ensure company names match filter value exactly (case-sensitive). Field Filter type in Metabase. |
| **All Reports** | Filter | Country (readable → ISO code) | country | filtered_players, players | `[[ AND players.country = CASE {{country}} WHEN 'Romania' THEN 'RO' WHEN 'France' THEN 'FR' WHEN 'Germany' THEN 'DE' ... END ]]` | Map readable country name to two-letter ISO code and filter players.country column | Mapping table includes 30+ countries inlined in SQL. players.country stores 2-letter ISO codes (RO, FR, DE, etc.). Extend CASE mapping if new countries needed. If country not in mapping, filter returns no results. |
| **All Reports** | Filter | Traffic Source (Organic/Affiliate) | traffic_source | filtered_players, players | `[[ AND CASE WHEN {{traffic_source}} = 'Organic' THEN players.affiliate_id IS NULL WHEN {{traffic_source}} = 'Affiliate' THEN players.affiliate_id IS NOT NULL ELSE TRUE END ]]` | Organic = NULL affiliate_id; Affiliate = NOT NULL affiliate_id; Any other value = no filter | If traffic_source not 'Organic' or 'Affiliate', ELSE TRUE means no filtering. Text/dropdown variable in Metabase. |
| **All Reports** | Filter | Affiliate ID | affiliate_id | filtered_players, players | `[[ AND {{affiliate_id}} ]]` → Field Filter on `players.affiliate_id` | Exact match on affiliate identifier in players table | Numeric field (assumes integer or bigint). Field Filter type ensures type safety. Can be NULL for organic players. |
| **All Reports** | Filter | Affiliate name | affiliate_name | filtered_players, players, affiliates (implicit) | `[[ AND {{affiliate_name}} ]]` → Field Filter mapped to affiliate name field | String match on affiliate name (likely via players → affiliates join) | If affiliate metadata stored in separate table, implicit join required. Field Filter handles mapping. Case-sensitive matching. |
| **All Reports** | Filter | Registration launcher (Device) | registration_launcher | filtered_players, players | `[[ AND CONCAT(players.os, ' / ', players.browser) = {{registration_launcher}} ]]` | String equality on concatenated `players.os + ' / ' + players.browser` | Format: "iOS / Safari", "Android / Chrome", "Windows / Firefox". Case-sensitive equality. Values must match exactly including spaces. Common values: "iOS / Safari", "Android / Chrome", "Windows / Chrome", "Windows / Firefox", "macOS / Safari". |
| **All Reports** | Filter | Test account flag | is_test_account | filtered_players, players | `[[ AND {{is_test_account}} ]]` → Field Filter on `players.is_test_account` (boolean) | Direct boolean filter on players.is_test_account column | TRUE = include test accounts; FALSE = exclude test accounts. For business reports, always set to FALSE. Field Filter ensures boolean type safety. |
| **All Reports** | Filter | Currency filter | currency_filter | All transaction CTEs, players, companies | `[[ AND UPPER(COALESCE(t.metadata->>'currency', t.cash_currency, players.wallet_currency, companies.currency)) IN ({{currency_filter}}) ]]` | 4-level currency resolution cascade: 1) t.metadata->>'currency' (highest priority), 2) t.cash_currency, 3) players.wallet_currency, 4) companies.currency (fallback). Then check if resolved currency IN provided list. | Comma-separated list in Metabase: 'EUR','USD','GBP'. All values UPPER-cased for comparison. If currency_filter not provided, no currency restriction. Important: this filter appears in ftd_first, deposit_metrics, withdrawal_metrics, active_players, betting_metrics, bonus_converted, bonus_cost CTEs. |
| **Daily KPIs, Monthly KPIs** | Dimension | Date (row identifier) | Date | date_series | Daily: `d::date AS report_date FROM generate_series(start_date, end_date, INTERVAL '1 day')`; Monthly: `DATE_TRUNC('month', d)::date FROM generate_series(..., INTERVAL '1 month')` | Each row = one day (Daily) or one month (Monthly). Generated from bounds.start_date to bounds.end_date at specified interval. | date_series also creates start_ts and end_ts for interval bounds. Daily end_ts = `LEAST(d + INTERVAL '1 day', NOW())` prevents future timestamps. TOTAL row has sort_order=-1, Date='TOTAL'. |
| **Daily KPIs, Monthly KPIs** | Metric | Registrations | #Registrations | registrations CTE (from player_reg, date_series) | player_reg joins filtered_players; counted where `pr.registration_ts >= ds.start_ts AND pr.registration_ts < ds.end_ts` | `COUNT(pr.*)` - counts all player records with registration_ts in that period | Includes all filtered players (player_reg INNER JOIN filtered_players). If filtered_players empty, counts=0. player_reg fetches: id, created_at, email_verified, brand_name. |
| **Daily KPIs, Monthly KPIs** | Metric | Complete Registrations | complete_registrations | registrations CTE / player_reg | Same as #Registrations but filtered: `pr.email_verified = TRUE` | `COUNT(CASE WHEN pr.email_verified = TRUE THEN 1 END)` | Subset of total registrations. Used for "%Conversion complete reg" calculation. May be NULL or 0 if no verified emails. |
| **Daily KPIs, Monthly KPIs** | Metric | First-Time Depositors | #FTDs | ftd_first, ftds, ftd_metrics CTEs | ftd_first: `MIN(t.created_at) per player` where `t.transaction_category='deposit' AND t.transaction_type='credit' AND t.status='completed' AND t.balance_type='withdrawable' AND created_at in bounds`; ftds: join to player_reg; ftd_metrics: count by report_date | `COUNT(DISTINCT f.player_id)` where `DATE_TRUNC('day', ff.first_deposit_ts) = report_date` | FTD definition: earliest completed withdrawable credit deposit in date window. Prior deposits outside window NOT considered. Currency filter applied in ftd_first CTE. TOTAL row recalculates across entire period for accuracy. |
| **Daily KPIs, Monthly KPIs** | Metric | New FTDs | #New FTDs | ftd_metrics (from ftds) | Filter ftds where `DATE_TRUNC('month', f.registration_ts) = DATE_TRUNC('month', f.first_deposit_ts)` | `COUNT(*) FILTER (WHERE month(registration) = month(first_deposit))` | Players who deposited in SAME MONTH they registered. Subset of #FTDs. Good benchmark: 20-40% of FTDs should be "new". |
| **Daily KPIs, Monthly KPIs** | Metric | % New FTDs | %New FTDs | Calculated from ftd_metrics | Numerator: #New FTDs; Denominator: #FTDs | `ROUND(CASE WHEN ftds_count > 0 THEN new_ftds::numeric / ftds_count * 100 ELSE 0 END, 2)` | Returns 0 if no FTDs. Percentage of FTDs that were "new" (same-month depositors). Helps measure immediate conversion quality. |
| **Daily KPIs, Monthly KPIs** | Metric | Old FTDs | #Old FTDs | ftd_metrics (from ftds) | Filter ftds where `DATE_TRUNC('month', f.registration_ts) < DATE_TRUNC('month', f.first_deposit_ts)` | `COUNT(*) FILTER (WHERE month(registration) < month(first_deposit))` | Players who deposited AFTER their registration month. Delayed conversion. Complementary to #New FTDs. |
| **Daily KPIs, Monthly KPIs** | Metric | % Old FTDs | % Old FTDs | Calculated from ftd_metrics | Numerator: #Old FTDs; Denominator: #FTDs | `ROUND(CASE WHEN ftds_count > 0 THEN old_ftds::numeric / ftds_count * 100 ELSE 0 END, 2)` | Returns 0 if no FTDs. Should sum with %New FTDs ≈ 100% (minor rounding differences possible). |
| **Daily KPIs, Monthly KPIs** | Metric | D0 FTDs (Same-day) | #D0 FTDs | ftd_metrics (from ftds) | Filter ftds where `DATE_TRUNC('day', f.registration_ts) = DATE_TRUNC('day', f.first_deposit_ts)` | `COUNT(*) FILTER (WHERE day(registration) = day(first_deposit))` | Players who deposited on SAME DAY as registration. Subset of #New FTDs. Good benchmark: 60-80% of New FTDs should be D0. Indicates strong initial engagement. |
| **Daily KPIs, Monthly KPIs** | Metric | % D0 FTDs | %D0 FTDs | Calculated from ftd_metrics | Numerator: #D0 FTDs; Denominator: #FTDs | `ROUND(CASE WHEN ftds_count > 0 THEN d0_ftds::numeric / ftds_count * 100 ELSE 0 END, 2)` | Percentage of all FTDs that happened same-day. High % indicates effective onboarding funnel. |
| **Daily KPIs, Monthly KPIs** | Metric | Late FTDs | #Late FTDs | ftd_metrics (from ftds) | Filter ftds where `DATE_TRUNC('day', f.registration_ts) <> DATE_TRUNC('day', f.first_deposit_ts)` | `COUNT(*) FILTER (WHERE day(registration) != day(first_deposit))` | Players who deposited after registration day (but could be same month or later). Complementary to #D0 FTDs. Late FTDs = #FTDs - #D0 FTDs. |
| **Daily KPIs, Monthly KPIs** | Metric | Conversion Rate (Total Reg) | %Conversion total reg | Calculated from registrations, ftd_metrics | Numerator: #FTDs; Denominator: #Registrations | `ROUND(CASE WHEN total_registrations > 0 THEN ftds_count::numeric / total_registrations * 100 ELSE 0 END, 2)` | Core acquisition efficiency metric. Good benchmark: 5-15% depending on market. Returns 0 if no registrations. TOTAL row recalculates for accuracy. |
| **Daily KPIs, Monthly KPIs** | Metric | Conversion Rate (Complete Reg) | %Conversion complete reg | Calculated from registrations (complete), ftd_metrics | Numerator: #FTDs; Denominator: complete_registrations | `ROUND(CASE WHEN complete_registrations > 0 THEN ftds_count::numeric / complete_registrations * 100 ELSE 0 END, 2)` | Conversion rate for verified emails only. Typically higher than total reg conversion. TOTAL row uses subquery for period-level calculation (more accurate than sum of daily percentages). |
| **Daily KPIs, Monthly KPIs** | Metric | Unique Depositors | Unique Depositors | deposit_metrics CTE | `COUNT(DISTINCT t.player_id) FILTER (WHERE t.transaction_category='deposit' AND t.transaction_type='credit' AND t.status='completed' AND t.balance_type='withdrawable')` | Count of distinct players who made at least one deposit in period | Different from #FTDs (which counts first-ever deposits). Unique Depositors includes repeat depositors. TOTAL row uses subquery to count distinct players across entire period (not sum of daily). |
| **Daily KPIs, Monthly KPIs** | Metric | Deposit Count | #Deposits | deposit_metrics CTE | `COUNT(*) FILTER (WHERE t.transaction_category='deposit' AND t.transaction_type='credit' AND t.status='completed' AND t.balance_type='withdrawable')` | Count of deposit transactions (not players) | One player can have multiple deposits. Use to calculate avg deposits per depositor: #Deposits / Unique Depositors. TOTAL row sums daily counts. |
| **Daily KPIs, Monthly KPIs** | Metric | Deposit Amount | Deposits Amount | deposit_metrics CTE | `SUM(CASE WHEN {{currency_filter}} = 'EUR' THEN COALESCE(t.eur_amount, t.amount) ELSE t.amount END) FILTER (WHERE transaction_category='deposit' AND type='credit' AND status='completed' AND balance_type='withdrawable')` | Sum of all deposit amounts with EUR conversion if currency_filter='EUR' | Uses COALESCE for NULL-safe EUR conversion: tries t.eur_amount first, falls back to t.amount. Returns 0 if no deposits (COALESCE on SUM). TOTAL row sums daily amounts. All amounts in EUR when currency_filter applied. |
| **Daily KPIs, Monthly KPIs** | Metric | Withdrawal Count | #Withdrawals | withdrawal_metrics CTE | `COUNT(t.id) FILTER (WHERE t.transaction_category='withdrawal' AND t.transaction_type='debit' AND t.balance_type='withdrawable' AND t.status='completed')` | Count of completed withdrawal transactions | Only completed withdrawals counted. Cancelled/pending excluded. TOTAL row sums counts. |
| **Daily KPIs, Monthly KPIs** | Metric | Withdrawal Amount | Withdrawals Amount | withdrawal_metrics CTE | `SUM(ABS(CASE WHEN {{currency_filter}} = 'EUR' THEN COALESCE(t.eur_amount, t.amount) ELSE t.amount END)) FILTER (WHERE category='withdrawal' AND type='debit' AND balance_type='withdrawable' AND status='completed')` | Sum of withdrawal amounts (absolute value) with EUR conversion | ABS() used because withdrawals stored as negative/debit. NULL-safe EUR conversion. Returns 0 if no withdrawals. TOTAL row sums daily amounts. |
| **Daily KPIs, Monthly KPIs** | Metric | Withdrawal Cancelled Amount | Withdrawals Amount Canceled | withdrawal_metrics CTE | `SUM(ABS(CASE ... END)) FILTER (WHERE category='withdrawal' AND type='debit' AND balance_type='withdrawable' AND status='cancelled')` | Sum of cancelled withdrawal amounts | Same as Withdrawals Amount but status='cancelled'. Useful for fraud detection and risk analysis. TOTAL row sums daily amounts. |
| **Daily KPIs, Monthly KPIs** | Metric | Withdrawal/Deposit Ratio | %Withdrawals/Deposits | Calculated | Numerator: Withdrawals Amount; Denominator: Deposits Amount | `ROUND(CASE WHEN deposits_amount > 0 THEN withdrawals_amount / deposits_amount * 100 ELSE 0 END, 2)` | Percentage of deposits that were withdrawn. <100% = positive cash flow. >100% = more withdrawals than deposits (warning). Returns 0 if no deposits. |
| **Daily KPIs, Monthly KPIs** | Metric | Cash Flow | CashFlow | Calculated | Deposits Amount - Withdrawals Amount | `ROUND(deposits_amount - withdrawals_amount, 2)` | Net money movement. Positive = more deposits than withdrawals (good). Negative = more withdrawals (review needed). TOTAL row sums daily cashflows. |
| **Daily KPIs, Monthly KPIs** | Metric | Active Players | Active Players | active_players CTE | `COUNT(DISTINCT CASE WHEN t.transaction_category='game_bet' THEN t.player_id END)` | Count distinct players with any bet transaction (cash or promo) | Includes both withdrawable and non-withdrawable bets. TOTAL row uses subquery to count distinct across entire period. |
| **Daily KPIs, Monthly KPIs** | Metric | Real Active Players | Real Active Players | active_players CTE | `COUNT(DISTINCT CASE WHEN t.transaction_category='game_bet' AND t.balance_type='withdrawable' THEN t.player_id END)` | Count distinct players with withdrawable (real money) bets only | Subset of Active Players. Excludes bonus-only players. TOTAL row uses subquery for accurate period count. |
| **Daily KPIs, Monthly KPIs** | Metric | Cash Bet | Cash Bet | betting_metrics CTE | `SUM(CASE WHEN {{currency_filter}} = 'EUR' THEN COALESCE(t.eur_amount, t.amount) ELSE t.amount END) FILTER (WHERE type='debit' AND category='game_bet' AND balance_type='withdrawable' AND status='completed')` | Sum of real money bets (withdrawable balance) | Includes only completed bets with real money. NULL-safe EUR conversion. Returns 0 if no bets. TOTAL row sums amounts. |
| **Daily KPIs, Monthly KPIs** | Metric | Cash Win | Cash Win | betting_metrics CTE | `SUM(CASE WHEN {{currency_filter}} = 'EUR' THEN COALESCE(t.eur_amount, t.amount) ELSE t.amount END) FILTER (WHERE type='credit' AND category='game_bet' AND balance_type='withdrawable' AND status='completed')` | Sum of winnings paid from real money bets | Credits to withdrawable balance from game_bet. TOTAL row sums amounts. |
| **Daily KPIs, Monthly KPIs** | Metric | Promo Bet | Promo bet | betting_metrics CTE | `SUM(CASE WHEN {{currency_filter}} = 'EUR' THEN COALESCE(t.eur_amount, t.amount) ELSE t.amount END) FILTER (WHERE type='debit' AND category='bonus' AND balance_type='non-withdrawable' AND status='completed')` | Sum of bonus money bets (non-withdrawable balance) | Tracks bonus utilization. Category='bonus' not 'game_bet'. TOTAL row sums amounts. |
| **Daily KPIs, Monthly KPIs** | Metric | Promo Win | Promo Win | betting_metrics CTE | `SUM(CASE WHEN {{currency_filter}} = 'EUR' THEN COALESCE(t.eur_amount, t.amount) ELSE t.amount END) FILTER (WHERE type='credit' AND category='bonus' AND balance_type='non-withdrawable' AND status='completed')` | Sum of winnings from bonus bets | Credits to non-withdrawable balance. TOTAL row sums amounts. |
| **Daily KPIs, Monthly KPIs** | Metric | Turnover | Turnover | Calculated | Cash Bet + Promo Bet | `ROUND(cash_bet + promo_bet, 2)` | Total wagering activity (real + bonus). Also used for "Turnover Casino" (same value). TOTAL row sums. |
| **Daily KPIs, Monthly KPIs** | Metric | Turnover Casino | Turnover Casino | Calculated | Cash Bet + Promo Bet | Same as Turnover | Duplicate metric for casino-specific reporting. Same calculation. |
| **Daily KPIs, Monthly KPIs** | Metric | Gross Gaming Revenue | GGR | Calculated | (Cash Bet + Promo Bet) - (Cash Win + Promo Win) | `ROUND((cash_bet + promo_bet) - (cash_win + promo_win), 2)` | House edge profit before bonus costs. Positive = house won more than paid out. TOTAL row sums. Core gaming profitability metric. |
| **Daily KPIs, Monthly KPIs** | Metric | GGR Casino | GGR Casino | Calculated | Same as GGR | Same as GGR | Duplicate for casino-specific reporting. |
| **Daily KPIs, Monthly KPIs** | Metric | Cash GGR | Cash GGR | Calculated | Cash Bet - Cash Win | `ROUND(cash_bet - cash_win, 2)` | Profit from real money gaming only (excludes bonuses). True cash profit before bonus costs. TOTAL row sums. |
| **Daily KPIs, Monthly KPIs** | Metric | Cash GGR Casino | Cash GGR Casino | Calculated | Same as Cash GGR | Same as Cash GGR | Duplicate for casino-specific reporting. |
| **Daily KPIs, Monthly KPIs** | Metric | Bonus Converted (Gross) | Bonus Converted (Gross) | bonus_converted CTE | `SUM(CASE WHEN {{currency_filter}} = 'EUR' THEN COALESCE(t.eur_amount, t.amount) ELSE t.amount END) FILTER (WHERE type='credit' AND category='bonus_completion' AND status='completed' AND balance_type='withdrawable')` | Sum of bonus money that became withdrawable cash | Category='bonus_completion' captures successful bonus conversions. Cost of successful bonuses. TOTAL row sums amounts. |
| **Daily KPIs, Monthly KPIs** | Metric | Bonus Cost | Bonus Cost | bonus_cost CTE | `SUM(CASE WHEN {{currency_filter}} = 'EUR' THEN COALESCE(t.eur_amount, t.amount) ELSE t.amount END) FILTER (WHERE type='credit' AND balance_type='withdrawable' AND status='completed' AND category='bonus_completion')` | Total cost of bonuses that converted to cash | Currently same implementation as Bonus Converted. Marketing/promotion expense. TOTAL row sums amounts. |
| **Daily KPIs, Monthly KPIs** | Metric | Bonus Ratio (GGR) | Bonus Ratio (GGR) | Calculated | Numerator: Bonus Cost; Denominator: GGR | `ROUND(CASE WHEN GGR > 0 THEN bonus_cost / GGR * 100 ELSE 0 END, 2)` | Bonus cost as % of revenue. Good benchmark: 10-25%. Returns 0 if GGR=0. High ratio = expensive bonuses. TOTAL row recalculates: sum(Bonus Cost) / sum(GGR). |
| **Daily KPIs, Monthly KPIs** | Metric | Bonus Ratio (Deposits) | Bonus Ratio (Deposits) | Calculated | Numerator: Bonus Cost; Denominator: Deposits Amount | `ROUND(CASE WHEN deposits_amount > 0 THEN bonus_cost / deposits_amount * 100 ELSE 0 END, 2)` | Alternative bonus efficiency view. Returns 0 if no deposits. TOTAL row recalculates. |
| **Daily KPIs, Monthly KPIs** | Metric | Payout Percentage | Payout % | Calculated | Numerator: (Cash Win + Promo Win); Denominator: (Cash Bet + Promo Bet) | `ROUND(CASE WHEN Turnover > 0 THEN (cash_win + promo_win) / Turnover * 100 ELSE 0 END, 2)` | How much players win back. Good benchmark: 92-97%. Regulatory compliance metric (RTP). TOTAL row recalculates: sum(Wins) / sum(Bets). |
| **Daily KPIs, Monthly KPIs** | Metric | CashFlow to GGR Ratio | %CashFlow to GGR | Calculated | Numerator: CashFlow; Denominator: GGR | `ROUND(CASE WHEN GGR > 0 THEN cashflow / GGR * 100 ELSE 0 END, 2)` | Cash efficiency indicator. Shows what % of GGR is actual cash movement. TOTAL row recalculates: sum(CashFlow) / sum(GGR). |
| **All Cohort Reports** | Dimension | Cohort Month | Cohort Month | first_deposits CTE | `DATE_TRUNC('month', MIN(t.created_at)) AS first_deposit_month` where deposit filters applied | Groups players by their first deposit month. Each row = one cohort (month). | Players locked to cohort based on first deposit date forever. Can't appear in multiple cohorts. Cohort Month format: YYYY-MM-DD (first day of month). |
| **All Cohort Reports** | CTE | First Deposit Identification | first_deposit_month, first_deposit_date | first_deposits CTE | `MIN(t.created_at) per player_id` where `category='deposit' AND type='credit' AND balance_type='withdrawable' AND status='completed' AND created_at in bounds` | Identifies each player's first deposit within the bounds period | Currency filter applied here. Prior deposits outside bounds NOT considered. Critical for cohort assignment. |
| **Depositors Cohort, Depositors Cohort %** | Metric | Month 0 Depositors | Month 0 | cohort_activity CTE | Count distinct depositors where `DATE_TRUNC('month', t.created_at) = first_deposit_month + INTERVAL '0 month'` | `COUNT(DISTINCT CASE WHEN months_diff = 0 THEN ca.player_id END)` | Baseline cohort size. Always 100% in percentage reports. All players who first deposited in cohort month. |
| **Depositors Cohort, Depositors Cohort %** | Metric | Month 1 Depositors | Month 1 | cohort_activity CTE | Count distinct depositors where `DATE_TRUNC('month', t.created_at) = first_deposit_month + INTERVAL '1 month'` | `COUNT(DISTINCT CASE WHEN months_diff = 1 THEN ca.player_id END)` | Players who deposited 1 month after first deposit. Retention indicator. % report: (Month 1 / Month 0) * 100. |
| **Depositors Cohort, Depositors Cohort %** | Metric | Month 2-12 Depositors | Month 2, Month 3, ..., Month 12 | cohort_activity CTE | Same pattern for months 2-12: `months_diff = X` | `COUNT(DISTINCT CASE WHEN months_diff = X THEN ca.player_id END)` for X in 2..12 | Each column shows retention at X months. % reports show retention rate vs Month 0. NULL if not enough time has passed (e.g., March 2025 cohort can't have Month 12 in April 2025). |
| **Deposit Amounts Cohort, Deposit Amounts Cohort %** | Metric | Month 0-12 Deposit Amounts | Month 0, Month 1, ..., Month 12 | cohort_activity CTE | Sum deposit amounts where `months_diff = X` | `SUM(CASE WHEN {{currency_filter}}='EUR' THEN COALESCE(t.eur_amount, t.amount) ELSE t.amount END) FILTER (WHERE months_diff = X AND category='deposit' AND type='credit' AND status='completed')` | Shows how much money each cohort deposits over time. % report: (Month X / Month 0) * 100 shows deposit trend vs first month. EUR conversion applied. |
| **Cash Players Cohort, Cash Players Cohort %** | Metric | Month 0-12 Cash Players | Month 0, Month 1, ..., Month 12 | cohort_activity CTE | Count distinct players with cash bets where `months_diff = X` | `COUNT(DISTINCT CASE WHEN months_diff = X AND category='game_bet' AND balance_type='withdrawable' THEN player_id END)` | Players who placed real money bets X months after first deposit. Shows gaming engagement retention. % report shows engagement rate vs Month 0. |
| **Cash Bet Amounts Cohort, Cash Bet Amounts Cohort %** | Metric | Month 0-12 Cash Bet | Month 0, Month 1, ..., Month 12 | cohort_activity CTE | Sum cash bet amounts where `months_diff = X` | `SUM(CASE WHEN {{currency_filter}}='EUR' THEN COALESCE(t.eur_amount, t.amount) ELSE t.amount END) FILTER (WHERE months_diff = X AND category='game_bet' AND type='debit' AND balance_type='withdrawable' AND status='completed')` | Total real money wagered by cohort at X months. % report: betting trend vs first month. High Month 0 then decline = normal. Increase over time = strong engagement. |
| **New Depositors Cohort, New Depositors Cohort %** | Metric | Month 0-12 New Depositors | Month 0, Month 1, ..., Month 12 | Based on registration month instead of first deposit month | Players grouped by `DATE_TRUNC('month', registration_ts)` then tracked for deposits in subsequent months | Similar to Depositors Cohort but cohort assignment based on registration date not first deposit date. Month 0 = deposits in registration month. Shows conversion timing. |
| **Existing Depositors Cohort, Existing Depositors Cohort %** | Metric | Month 0-12 Existing Depositors | Month 0, Month 1, ..., Month 12 | Players who made deposits AFTER registration month | Excludes new depositors (who deposited in registration month). Tracks repeat/returning depositors only. | Shows delayed activation patterns. Month 0 typically low or zero (by definition). Tracks players who activated later. |
| **Cohort LTV Lifetime** | Metric | Lifetime Deposits | Total Deposits | Aggregated across all months | `SUM(all deposit amounts)` for entire cohort lifetime | Sum of all deposits from cohort players regardless of month | No month segmentation. Total value brought by cohort over entire tracked period. |
| **Cohort LTV Lifetime** | Metric | Lifetime LTV | LTV | Calculated | Total Deposits / FTD Count | `ROUND(total_deposits / ftd_count, 2)` | Average money brought in per depositor. Compare to acquisition cost. Returns 0 if no FTDs. Used for cohort profitability analysis. |
| **Bonus Report Dashboard** | Filter | Bonus Campaign ID | bonus_campaign_id | bonus_transactions (likely), campaigns table | `[[ AND {{bonus_campaign_id}} ]]` → Field Filter on campaign identifier | Filters to specific bonus campaign | Bonus report has 25+ filters. Check bonus_report_dashboard.sql for complete list. Campaign-specific analysis. |
| **Bonus Report Dashboard** | Metric | Bonus Issued | Bonus Issued Amount | bonus_transactions | Sum where `category='bonus_issued' AND type='credit'` | Total bonus money issued to players | Tracks bonus liability. Different from Bonus Cost (which tracks converted bonuses). |
| **Bonus Report Dashboard** | Metric | Bonus Wagered | Bonus Wagered Amount | transactions | Sum where `category='bonus' AND type='debit' AND balance_type='non-withdrawable'` | How much bonus money was actually wagered | Measures bonus utilization. Compare to Bonus Issued to see utilization rate. |
| **Bonus Report Dashboard** | Metric | Bonus Conversion Rate | Bonus Conversion % | Calculated | Numerator: Bonus Converted; Denominator: Bonus Issued | `(Bonus Converted / Bonus Issued) * 100` | Percentage of issued bonuses that converted to withdrawable cash. Low rate = difficult wagering requirements or poor bonus design. |

---

## Notes & Debugging Tips by Category

### Date/Time Issues
- **Timezone:** All timestamps in UTC. Ensure client filters use UTC dates.
- **Inclusive ranges:** Most queries use `>= start` and `< end + 1 day` for inclusive end date
- **Future dates:** date_series uses `LEAST(d + INTERVAL '1 day', NOW())` to prevent future timestamps
- **Cohort month boundaries:** Use `DATE_TRUNC('month', ...)` consistently

### Filter Debugging
- **Empty results:** Check if filtered_players CTE returns rows. If empty, all metrics = 0.
- **Country filter:** Uses ISO codes (RO, FR, DE). Display shows full names ("Romania", "France").
- **Device filter:** Case-sensitive. Must match exactly: "iOS / Safari" not "ios/safari" or "iOS/Safari"
- **Currency filter:** UPPER-cased comparison. List format: 'EUR','USD','GBP' (single quotes required)
- **Test accounts:** Always exclude for business reports (set is_test_account filter to FALSE)

### Metric Calculation Issues
- **Division by zero:** All percentage calculations have `CASE WHEN denominator > 0 THEN ... ELSE 0 END`
- **NULL handling:** All SUM() wrapped in COALESCE(..., 0) to return 0 instead of NULL
- **TOTAL row accuracy:** Some metrics recalculated in TOTAL row via subquery (more accurate than sum of daily values). Examples: Unique Depositors, Active Players, %Conversion complete reg.
- **EUR conversion:** Uses `COALESCE(t.eur_amount, t.amount)` - tries EUR column first, falls back to original amount
- **Cohort NULL values:** Month X shows NULL if not enough time passed. E.g., March 2025 cohort can't show Month 12 until March 2026.

### Transaction Category Matrix
- **Deposits:** category='deposit', type='credit', balance_type='withdrawable', status='completed'
- **Withdrawals:** category='withdrawal', type='debit', balance_type='withdrawable', status='completed'
- **Cash Bet:** category='game_bet', type='debit', balance_type='withdrawable', status='completed'
- **Cash Win:** category='game_bet', type='credit', balance_type='withdrawable', status='completed'
- **Promo Bet:** category='bonus', type='debit', balance_type='non-withdrawable', status='completed'
- **Promo Win:** category='bonus', type='credit', balance_type='non-withdrawable', status='completed'
- **Bonus Converted:** category='bonus_completion', type='credit', status='completed'

### Common Investigation Patterns
1. **Metric too low?** Check if too many filters applied, verify date range, check filtered_players count
2. **Metric too high?** Check if test accounts included, verify currency filter, check for duplicate transactions
3. **Percentages > 100%?** Usually indicates data quality issue or incorrect denominator
4. **Cohort retention strange?** Ensure enough time passed for month to populate, compare absolute vs percentage views
5. **Numbers don't match between reports?** Check date boundaries (daily vs monthly), verify same filters applied

---

**Document Version:** 1.0
**Total Items Documented:** 80+ inputs, filters, and metrics
**Coverage:** All 16 SQL reports
**Last Updated:** October 31, 2025
